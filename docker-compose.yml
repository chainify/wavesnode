version: "2"

services:
  nginx:
    image: chainify/waves-nginx
    container_name: waves-nginx
    # ports:
    #   - 6868:6868
    #   - 6869:6869
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf
    depends_on:
      - fullnode
    restart: always

  fullnode:
    image: wavesplatform/wavesnode
    container_name: waves-fullnode
    volumes:
      - /root/.waves/mainnet:/var/lib/waves
      - ./fullnode/configs:/etc/waves
    # command: bash -c "java -jar node/target/waves-all*.jar ../configs/waves-mainnet.conf"
    ports:
      - 6868:6868
      - 6869:6869
    environment:
      - WAVES_NETWORK=mainnet
      - WAVES_VERSION=latest
      - BRANCH=version-0.17.x
      - SBT_VERSION=1.2.8
      - WAVES_LOG_LEVEL=DEBUG
      - WAVES_HEAP_SIZE=2g
      # - WAVES_WALLET_SEED=
      # - WAVES_WALLET_PASSWORD=
      - JAVA_OPTS="-Dwaves.rest-api.enable=yes -Dwaves.rest-api.bind-address=0.0.0.0"
    tty: true
    stdin_open: true
    labels:
      - "autoheal=true"
    restart: always

  autoheal:
    image: willfarrell/autoheal:latest
    container_name: waves-autoheal
    restart: always
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    environment:
      - AUTOHEAL_CONTAINER_LABEL=autoheal
